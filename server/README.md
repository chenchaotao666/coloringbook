# æ¶‚è‰²ä¹¦ API æœåŠ¡å™¨

åŸºäº Express.js å’Œ PostgreSQL çš„å®Œæ•´æ¶‚è‰²ä¹¦åç«¯æœåŠ¡ï¼Œæ”¯æŒç”¨æˆ·ç®¡ç†ã€å›¾ç‰‡ç”Ÿæˆã€æ–‡ä»¶ä¸Šä¼ ç­‰åŠŸèƒ½ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **ç”¨æˆ·ç®¡ç†**: æ³¨å†Œã€ç™»å½•ã€æ›´æ–°ä¿¡æ¯ã€å¤´åƒä¸Šä¼ ã€å……å€¼
- **å›¾ç‰‡ç®¡ç†**: æŸ¥è¯¢ã€æ–‡æœ¬ç”Ÿæˆå›¾ç‰‡ã€å›¾ç‰‡è½¬æ¢ã€åˆ é™¤ã€ä¸¾æŠ¥
- **åˆ†ç±»ç®¡ç†**: è·å–æ‰€æœ‰åˆ†ç±»å’Œåˆ†ç±»è¯¦æƒ…
- **ä»»åŠ¡ç®¡ç†**: æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ã€è·å–ç”¨æˆ·ä»»åŠ¡ã€å–æ¶ˆä»»åŠ¡
- **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒå¤´åƒå’Œå›¾ç‰‡ä¸Šä¼ ï¼Œè‡ªåŠ¨å‹ç¼©å’Œå¤„ç†
- **å‚æ•°éªŒè¯**: å®Œæ•´çš„è¯·æ±‚å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
- **è®¤è¯æˆæƒ**: JWT ä»¤ç‰Œè®¤è¯å’Œæƒé™æ§åˆ¶
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯ç å’Œå“åº”æ ¼å¼

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- PostgreSQL >= 12
- npm æˆ– yarn

## ğŸ› ï¸ å®‰è£…å’Œé…ç½®

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. ç¯å¢ƒå˜é‡é…ç½®

å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶å¹¶é…ç½®ï¼š

```bash
cp env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å˜é‡ï¼š

```env
# æ•°æ®åº“è¿æ¥
DATABASE_URL="postgresql://username:password@localhost:5432/coloring_book_db"

# æœåŠ¡å™¨é…ç½®
PORT=3001
NODE_ENV=development

# JWTå¯†é’¥
JWT_SECRET=your-super-secret-jwt-key-here-change-in-production
JWT_REFRESH_SECRET=your-super-secret-refresh-key-here-change-in-production

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_DIR=uploads
MAX_FILE_SIZE=10485760
ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/gif,image/webp

# CORSé…ç½®
CORS_ORIGIN=http://localhost:3000
```

### 3. æ•°æ®åº“è®¾ç½®

ç”Ÿæˆ Prisma å®¢æˆ·ç«¯ï¼š

```bash
npm run db:generate
```

æ¨é€æ•°æ®åº“æ¨¡å¼ï¼š

```bash
npm run db:push
```

åˆå§‹åŒ–ç§å­æ•°æ®ï¼š

```bash
npm run db:seed
```

## ğŸš€ å¯åŠ¨æœåŠ¡

### å¼€å‘æ¨¡å¼

```bash
npm run dev
```

### ç”Ÿäº§æ¨¡å¼

```bash
npm start
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3001` å¯åŠ¨ã€‚

## ğŸ“š API æ–‡æ¡£

è¯¦ç»†çš„ API æ–‡æ¡£è¯·å‚è€ƒ [API_DOCS.md](./API_DOCS.md)ã€‚

### ä¸»è¦ç«¯ç‚¹

- **å¥åº·æ£€æŸ¥**: `GET /health`
- **ç”¨æˆ·ç®¡ç†**: `/api/users/*`
- **å›¾ç‰‡ç®¡ç†**: `/api/images/*`
- **åˆ†ç±»ç®¡ç†**: `/api/categories/*`
- **ä»»åŠ¡ç®¡ç†**: `/api/tasks/*`

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
server/
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma          # æ•°æ®åº“æ¨¡å¼å®šä¹‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js        # æ•°æ®åº“é…ç½®
â”‚   â”‚   â””â”€â”€ constants.js       # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ userController.js  # ç”¨æˆ·æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ imageController.js # å›¾ç‰‡æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ categoryController.js # åˆ†ç±»æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ taskController.js  # ä»»åŠ¡æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js           # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ upload.js         # æ–‡ä»¶ä¸Šä¼ ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ userRoutes.js     # ç”¨æˆ·è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ imageRoutes.js    # å›¾ç‰‡è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ categoryRoutes.js # åˆ†ç±»è·¯ç”±
â”‚   â”‚   â””â”€â”€ taskRoutes.js     # ä»»åŠ¡è·¯ç”±
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ seed.js           # æ•°æ®åº“ç§å­è„šæœ¬
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ response.js       # å“åº”å·¥å…·
â”‚   â”‚   â””â”€â”€ fileUtils.js      # æ–‡ä»¶å·¥å…·
â”‚   â”œâ”€â”€ validation/
â”‚   â”‚   â”œâ”€â”€ userValidation.js # ç”¨æˆ·éªŒè¯
â”‚   â”‚   â””â”€â”€ imageValidation.js # å›¾ç‰‡éªŒè¯
â”‚   â””â”€â”€ server.js             # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ uploads/                  # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ images-mock/              # é¢„åˆ¶å›¾ç‰‡ç›®å½•
â”œâ”€â”€ package.json
â”œâ”€â”€ env.example
â””â”€â”€ README.md
```

## ğŸ§ª æµ‹è¯•è´¦æˆ·

ç§å­æ•°æ®åŒ…å«ä»¥ä¸‹æµ‹è¯•è´¦æˆ·ï¼š

**Pro ç”¨æˆ·**
- é‚®ç®±: `test@example.com`
- å¯†ç : `password123`
- ç§¯åˆ†: 100

**Lite ç”¨æˆ·**
- é‚®ç®±: `demo@example.com`
- å¯†ç : `password123`
- ç§¯åˆ†: 50

## ğŸ”§ å¼€å‘å·¥å…·

### æ•°æ®åº“ç®¡ç†

```bash
# æŸ¥çœ‹æ•°æ®åº“
npm run db:studio

# é‡ç½®æ•°æ®åº“
npm run db:push --force-reset

# é‡æ–°åˆå§‹åŒ–ç§å­æ•°æ®
npm run db:seed
```

### æ—¥å¿—å’Œè°ƒè¯•

- å¼€å‘ç¯å¢ƒä¸‹ä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¯·æ±‚æ—¥å¿—
- æ‰€æœ‰é”™è¯¯éƒ½ä¼šè®°å½•åˆ°æ§åˆ¶å°
- æ”¯æŒ Prisma æŸ¥è¯¢æ—¥å¿—

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **Helmet**: è®¾ç½®å®‰å…¨ç›¸å…³çš„ HTTP å¤´
- **CORS**: è·¨åŸŸèµ„æºå…±äº«é…ç½®
- **é€Ÿç‡é™åˆ¶**: é˜²æ­¢ API æ»¥ç”¨
- **JWT è®¤è¯**: å®‰å…¨çš„ç”¨æˆ·è®¤è¯
- **å‚æ•°éªŒè¯**: é˜²æ­¢æ¶æ„è¾“å…¥
- **æ–‡ä»¶ä¸Šä¼ é™åˆ¶**: é™åˆ¶æ–‡ä»¶ç±»å‹å’Œå¤§å°

## ğŸ“ é”™è¯¯å¤„ç†

API ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ï¼š

```json
{
  "status": "fail",
  "errorCode": "1001",
  "message": "é”™è¯¯æè¿°"
}
```

é”™è¯¯ç åˆ†ç±»ï¼š
- 1000-1999: ç”¨æˆ·ç›¸å…³é”™è¯¯
- 2000-2999: å›¾ç‰‡ç›¸å…³é”™è¯¯
- 3000-3999: åˆ†ç±»ç›¸å…³é”™è¯¯
- 4000-4999: ä¸¾æŠ¥ç›¸å…³é”™è¯¯
- 9000-9999: ç³»ç»Ÿç›¸å…³é”™è¯¯

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚ 